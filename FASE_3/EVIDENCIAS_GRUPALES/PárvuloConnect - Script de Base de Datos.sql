CREATE TABLE USER (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    USERNAME VARCHAR2(150) NOT NULL,
    RUT VARCHAR2(12) DEFAULT '11.111.111-1',
    NOMBRE VARCHAR2(50) DEFAULT '',
    APELLIDO VARCHAR2(50) DEFAULT '',
    EDAD NUMBER(3) DEFAULT 1,
    FECHA_NACIMIENTO DATE DEFAULT TO_DATE('1950-01-01', 'YYYY-MM-DD'),
    TELEFONO VARCHAR2(12) DEFAULT '',
    EMAIL VARCHAR2(50) DEFAULT '',
    DIRECCION VARCHAR2(50) DEFAULT '',
    IS_APODERADO NUMBER(1) DEFAULT 1,
    IS_PARVULARIA NUMBER(1) DEFAULT 0,
    CONSTRAINT CHK_USER_EMAIL CHECK (EMAIL LIKE '%@%'),
    CONSTRAINT CHK_USER_EDAD CHECK (EDAD > 0)
);

CREATE TABLE APODERADO (
    USERAPODERADO_ID NUMBER PRIMARY KEY,
    CONSTRAINT FK_APODERADO_USER FOREIGN KEY (USERAPODERADO_ID) REFERENCES USER (ID) ON DELETE CASCADE
);

CREATE TABLE PLANIFICACION (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DESCRIPCION VARCHAR2(255),
    DOCUMENTO BLOB,
    SUBIDO_A TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE REPORTES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DESCRIPCION VARCHAR2(255),
    DOCUMENTO BLOB,
    SUBIDO_A TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE CURSO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CODIGO_CURSO VARCHAR2(20) UNIQUE,
    NOMBRE_CURSO VARCHAR2(100) NOT NULL,
    CREATED TIMESTAMP DEFAULT SYSTIMESTAMP,
    UPDATED TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE ESTUDIANTE (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_ESTUDIANTE VARCHAR2(20) UNIQUE,
    NOMBRE VARCHAR2(100) NOT NULL,
    CURSO_ID NUMBER NOT NULL,
    CREATED TIMESTAMP DEFAULT SYSTIMESTAMP,
    UPDATED TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_ESTUDIANTE_CURSO FOREIGN KEY (CURSO_ID) REFERENCES CURSO (ID) ON DELETE CASCADE
);

CREATE TABLE ASISTENCIA (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ESTUDIANTE_ID NUMBER NOT NULL,
    FECHA DATE NOT NULL,
    ESTADO_ASISTENCIA CHAR(1) CHECK (ESTADO_ASISTENCIA IN ('P', 'A')),
    CREATED TIMESTAMP DEFAULT SYSTIMESTAMP,
    UPDATED TIMESTAMP DEFAULT SYSTIMESTAMP,
    CONSTRAINT FK_ASISTENCIA_ESTUDIANTE FOREIGN KEY (ESTUDIANTE_ID) REFERENCES ESTUDIANTE (ID) ON DELETE CASCADE
);

CREATE TABLE NOTAS (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ESTUDIANTE_ID NUMBER NOT NULL,
    CURSO_ID NUMBER NOT NULL,
    PERIODO_ID VARCHAR2(10) DEFAULT '2020-2021',
    SEMESTRE VARCHAR2(3) NOT NULL,
    NOTA CHAR(2) CHECK (NOTA IN ('L', 'NL')) DEFAULT 'L',
    NIVEL CHAR(3) CHECK (NIVEL IN ('DFM', 'DSE', 'DCG', 'DCM')) DEFAULT 'DFM',
    SESION CHAR(2) CHECK (SESION IN ('1', '2', '3', '4', '5', '6', '7', '8', '9', '10')) DEFAULT '10',
    CONSTRAINT FK_NOTAS_ESTUDIANTE FOREIGN KEY (ESTUDIANTE_ID) REFERENCES ESTUDIANTE (ID) ON DELETE CASCADE,
    CONSTRAINT FK_NOTAS_CURSO FOREIGN KEY (CURSO_ID) REFERENCES CURSO (ID) ON DELETE CASCADE
);

CREATE TABLE PLANIFICACION_APODERADO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DESCRIPCION VARCHAR2(255),
    DOCUMENTO BLOB,
    SUBIDO_A TIMESTAMP DEFAULT SYSTIMESTAMP
);

CREATE TABLE REPORTES_APODERADO (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DESCRIPCION VARCHAR2(255),
    DOCUMENTO BLOB,
    SUBIDO_A TIMESTAMP DEFAULT SYSTIMESTAMP
);

